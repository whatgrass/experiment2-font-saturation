<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>實驗二：字型飽和測驗</title>
    
    <!-- jsPsych CSS（使用 jsdelivr CDN） -->
    <link href="https://cdn.jsdelivr.net/npm/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css"/>
    
    <!-- 實驗專屬 CSS -->
    <link href="./css/experiment2.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <!-- 初始載入畫面 - 顯示開始按鈕 -->
    <div id="start-screen" style="text-align: center; padding: 100px 20px;">
        <h1>實驗二：字型飽和測驗</h1>
        <p style="font-size: 18px; margin: 30px 0;">請準備好後，點擊下方按鈕開始實驗</p>
        <button id="start-button" class="start-btn">開始實驗</button>
        <div id="loading" style="display: none; margin-top: 30px;">
            <p>正在載入實驗...</p>
            <div class="spinner"></div>
        </div>
    </div>
    
    <!-- jsPsych 實驗容器 -->
    <div id="jspsych-experiment" style="display: none;"></div>
    
    <!-- jsPsych 核心庫（使用 jsdelivr CDN） -->
    <script src="https://cdn.jsdelivr.net/npm/jspsych@7.3.3/dist/jspsych.js"></script>
    
    <!-- 等待 jsPsych 載入完成後再載入外掛 -->
    <script>
        // 確保 jsPsych 載入完成後再載入外掛
        (function() {
            function loadPlugin(src, callback) {
                var script = document.createElement('script');
                script.src = src;
                script.onload = callback;
                script.onerror = function() {
                    console.error('無法載入外掛: ' + src);
                    document.getElementById('loading').innerHTML = 
                        '<p style="color: red;">錯誤：無法載入外掛 ' + src + '</p>';
                };
                document.body.appendChild(script);
            }
            
            // 等待 jsPsych 載入
            var checkCount = 0;
            var maxChecks = 50; // 最多檢查 5 秒
            
            function checkJsPsych() {
                checkCount++;
                if (typeof initJsPsych !== 'undefined') {
                    console.log('jsPsych 已載入，開始載入外掛...');
                    // jsPsych 已載入，現在載入外掛
                    loadPlugin('https://cdn.jsdelivr.net/npm/@jspsych/plugin-html-keyboard-response@1.1.1/dist/index.browser.js', function() {
                        console.log('html-keyboard-response 外掛已載入');
                        loadPlugin('https://cdn.jsdelivr.net/npm/@jspsych/plugin-html-button-response@1.1.1/dist/index.browser.js', function() {
                            console.log('html-button-response 外掛已載入');
                            console.log('所有外掛載入完成，載入實驗程式...');
                            // 所有外掛載入完成，載入實驗程式
                            var expScript = document.createElement('script');
                            expScript.src = './script/experiment2.js';
                            expScript.onerror = function() {
                                console.error('無法載入實驗程式');
                                document.getElementById('loading').innerHTML = 
                                    '<p style="color: red;">錯誤：無法載入實驗程式</p>';
                            };
                            document.body.appendChild(expScript);
                        });
                    });
                } else if (checkCount < maxChecks) {
                    // 等待一下再檢查
                    setTimeout(checkJsPsych, 100);
                } else {
                    console.error('jsPsych 載入超時');
                    document.getElementById('loading').innerHTML = 
                        '<p style="color: red;">錯誤：jsPsych 載入超時，請檢查網路連線</p>';
                }
            }
            
            // 開始檢查
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', checkJsPsych);
            } else {
                checkJsPsych();
            }
        })();
    </script>
</body>
</html>

